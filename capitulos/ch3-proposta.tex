% ==============================================================================
% TCC - Nome do Aluno
% Capítulo 3 - Proposta do Trabalho
% ==============================================================================
\chapter{Proposta do Trabalho}
\label{sec-proposta}

Nesta seção é apresentada a proposta para a estimativa dos parâmetros do 
modelo compartimental e os testes para averiguar a efetividade do método.

\section{Estimativa de parâmetros}

Os modelos compartimentais possuem parâmetros de transmissão e mortalidade
fixos, considerando que estes modelos foram pensados apenas para dar 
uma projeção de como uma epidemia evoluirá. Entretanto, medidas de afastamento
social são capazes de alterar o parâmetro de transmissão ao longo do tempo.
Utilizando \cite{long-etal:21-L2} como inspiração, é proposto obter o parâmetro
$\beta$ como uma função em função do tempo. A rede neural deverá se ajustar 
a um $\beta(t)$. A taxa de mortalidade de uma doença permanece constante
caso não haja um plano de vacinação, logo não há a necessidade de estimá-lo. 

\begin{eqnarray}
   \frac{dS(t)}{dt} &=& -\beta(t) S(t) I(t),  \quad t > t_0, \label{eq:SIR-beta-t-1}\\
   \frac{dI(t)}{dt} &=& \beta(t) S(t) I(t) - \gamma I(t), \quad t > t_0, \label{eq:SIR-beta-t-2}\\
   \frac{dR(t)}{dt} &=& \gamma I(t),  \quad t > t_0, \label{eq:SIR-beta-t-3}
\end{eqnarray}

Como $S(t) + I(t) + R(t) = N$ para todo $t > t_0$, podemos simplificar as equações
acima \cite{millevoi-etal:24-split-join-pinns}

\section{Testes com Dados Sintéticos}

Para averiguar se o método proposto funcionará bem com dados reais,
será feito primeiramente um teste com dados sintéticos obtidos apatir da solução
do modelo compartimental utilizando o método de Runge-Kutta de 4º ordem
implementado na biblioteca \textit{SciPy} \cite{scipy}. As condições iniciais
do problema estão definadas nas equações abaixo.

\begin{eqnarray}
   S_0 &=& 0.99 \label{eq:S0}\\
   I_0 &=& 0.01, \label{eq:I0}\\
   R_0 &=& 0 \label{eq:R0}
\end{eqnarray}

Para simular uma variação anual na taxa de infecção de uma doença, o parâmetro
$\beta(t)$ é aproximado por uma função seno.semper facilisis lorem 

\begin{equation} \label{eq:beta_t_sintetetico}
    \beta(t) = \sin(t / 12)  + \beta_{min}
\end{equation}

Utilizando

\section{Testes com Dados Sintéticos Ruidosos}

Segundo \cite{raissi-etal:19}, PINNs são resilientes a dados ruidosos. Para
testar se PINNs são capazes de ajustar a 
adicionar ruído gaussiano aos dados sintéticos. A equação \ref{eq:ruido-gaussiano}
descreve este processo.

\begin{eqnarray}\label{eq:ruido-gaussiano}
    Z_t \sim \mathcal{N}(0, \sigma) \\
    \mathcal{N}_t = \mathcal{C}_t + Z_t  
\end{eqnarray}

\section{Testes com Base de Dados Reais}

Os dados foram coletados do plataforma \textit{OpenDataSUS} \cite{opendatasus}


\subsection{Bases de dados do DataSUS}

\subsection{Tratamento dos Dados}
Janela móvel de 7 dias como em \cite{han-etal:24-prim-artigo-alemanha},
\cite{long-etal:21-L2} e \cite{shamsara-etal:25-omicron} para suavizar o ruído

Pesos ajustáveis entre a loss física e a loss dos dados como em 
\cite{long-etal:21-L2} e 
\cite{shamsara-etal:25-omicron}

Segundo \cite{bonfanti-etal:24-generalizacao-pinns}, PINNs não generalizam bem
fora do domínio de treinamento. PINNs podem estimar os parâmetros para fora
do domínio de treinamento como em \cite{millevoi-etal:24-split-join-pinns}.

Assim como em \cite{ghosh-etal:23-subnotificacao}, fazer testes com lacunas
nos dados para testar a resiliência do método.

\subsection{Arquitetura da Rede}

Baseando-se em \cite{shaier-etal:22-dinns}, o número de camadas escolhido foi...

Como em \cite{millevoi-etal:24-split-join-pinns}, aplicar uma 
\textit{hard-constraint} na rede neural ao utilizar nos nós de saída
uma função de ativação que retorna apenas valores positivos.

\subsection{Correlação com a Temperatura}

A gripe é uma doença com maior taxa de transmissão nos meses frios. 
Para testar se a transmissão em função do tempo aproximada pelo modelo é plausível,
é feito um teste de correlação de \textit{Pearson} entre $\beta(t)$ e a temperatura
ao longo do ano.

\subsubsection{Teste de Correlação de Pearson}

Sendo $\beta$ e $T$ duas amostras de tamanho $n$ com dados pareados $(\beta_i, T_i)$:
\begin{equation}\label{correlacao-de-pearson}
\rho = \frac{\sum_{i=1}^{n} (\beta_i - \bar{\beta})(T_i - \bar{T})}{\sqrt{\sum_{i=1}^{n} (\beta_i - \bar{\beta})^2 \sum_{i=1}^{n} (T_i - \bar{T})^2}}
\end{equation}

Espera-se um valor de $\rho$ acima de 0.5 para indicar um correlação no minímo moderada
entre a taxa de transmissão $\beta$ e a temperatura.

\subsubsection{Teste de Correlação de Spearman}

A correlação de Spearman é equivalent a calcular a correlação de Pearson nos 
\textit{ranks} dos valores.

\begin{equation}
r_s = \frac{\sum_{i=1}^{n} (R(\beta_i) - \bar{R_{\beta}})(R(T_i) - \bar{R_{T}})}{\sqrt{\sum_{i=1}^{n} (R(\beta_i) - \bar{R_{\beta}})^2 \sum_{i=1}^{n} (R(T_i) - \bar{R_T})^2}}
\end{equation}

Caso haja empates entre os elementos das amostras, aplica-se a fórmula de ajuste
abaixo.

\begin{equation}
r_s = \frac{\sum_{i=1}^{n} (R(\beta_i) - \bar{R_{\beta}})(R(T_i) - \bar{R_y})}{\sqrt{\left[\sum_{i=1}^{n} (R(x_i) - \bar{R_x})^2 - T_x\right]\left[\sum_{i=1}^{n} (R(y_i) - \bar{R_y})^2 - T_y\right]}}
\end{equation}

Sendo que os fatores $T_x$ e $T_y$ de correção de empate são calculados
usando as fórmulas abaixo.  

\begin{equation}
\mathcal{T} = \sum \frac{t^3 - t}{12}
\end{equation}


\section{Implementação}

A implementação foi feita utilizando a biblioteca \textit{DeepXDE} \cite{lu-etal:21-deepxde}, 
utilizando o \textit{TensorFlow} \cite{tensorflow:16} como \textit{backend}. 
Todo o código, dados utilizados nos experimentos,
encontram-se disponíveis no repositório público no 
GitHub\footnote{\url{https://github.com/ginbar/inverse-cm}}.
